<app-menu></app-menu>

<div class="container my-3">

    <app-header [title]="'chocolate ' + strTitleSingular">
    </app-header>
    <div class="row justify-content-center">

        <form [formGroup]="oForm" (ngSubmit)="onSubmit()">

            <div class="row mb-3">
                <label for="ubicacion" class="col-sm-2 col-form-label">Ubicacion</label>
                <div class="col-sm-10">
                    <div class="row mb-3">
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="ubicacion" formControlName="ubicacion"
                                [ngClass]="{'is-valid' : f.ubicacion.dirty && !(f.ubicacion.errors?.required || f.ubicacion.errors?.minlength) }">
                            <div *ngIf="f.ubicacion.dirty && f.ubicacion.errors?.required" class="text-danger">
                                Se debe introducir una ubicación
                            </div>
                            <div *ngIf="f.ubicacion.dirty && f.ubicacion.errors?.minlength" class="text-danger">
                                La ubicación introducido es demasiado corta
                            </div>
                        </div>
                    </div>
                </div>

                
            
            <label for="" class="col-sm-2 col-form-label">Tipo de venta</label>

            <div class="col-sm-10">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="tipoventa" id="tipoventa" value="comprar" formControlName="tipoventa"/>
                    <label class="form-check-label" for="tipoventa"> Comprar </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="tipoventa" id="tipoventa" value="alquilar" formControlName="tipoventa"/>
                    <label class="form-check-label" for="tipoventa"> Alquilar </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="tipoventa" id="tipoventa" value="obranueva" formControlName="tipoventa"/>
                    <label class="form-check-label" for="tipoventa"> Obra nueva</label>
                </div>
            </div>
            <label for="precio" class="col-sm-2 col-form-label">Precio</label>
            <div class="col-sm-10">
                <div class="row mb-3">
                    <div class="col-sm-10">
                        <input type="number" step="any" class="form-control" id="precio" formControlName="precio"
                            [ngClass]="{'is-valid' : f.precio.dirty && !(f.precio.errors?.required || f.precio.errors?.minlength) }">
                        <div *ngIf="f.precio.dirty && f.precio.errors?.required" class="text-danger">
                            Se debe introducir un precio
                        </div>
                        <div *ngIf="f.precio.dirty && f.precio.errors?.minlength" class="text-danger">
                            El precio introducido es demasiado corto
                        </div>
                    </div>
                </div>
            </div>
            <label for="m2utiles" class="col-sm-2 col-form-label">Metros² Utiles</label>
            <div class="col-sm-10">
                <div class="row mb-3">
                    <div class="col-sm-10">
                        <input type="number" step="any" class="form-control" id="m2utiles" formControlName="m2utiles"
                            [ngClass]="{'is-valid' : f.m2utiles.dirty && !(f.m2utiles.errors?.required || f.m2utiles.errors?.minlength) }">
                        <div *ngIf="f.m2utiles.dirty && f.m2utiles.errors?.required" class="text-danger">
                            Se debe introducir metros² utiles
                        </div>
                        <div *ngIf="f.m2utiles.dirty && f.m2utiles.errors?.minlength" class="text-danger">
                            metros² utiles introducidos es demasiado corto
                        </div>
                    </div>
                </div>
            </div>
            <label for="m2construidos" class="col-sm-2 col-form-label">Metros² construidos</label>
            <div class="col-sm-10">
                <div class="row mb-3">
                    <div class="col-sm-10">
                        <input type="number" step="any" class="form-control" id="m2construidos"
                            formControlName="m2construidos"
                            [ngClass]="{'is-valid' : f.m2construidos.dirty && !(f.m2construidos.errors?.required || f.m2construidos.errors?.minlength) }">
                        <div *ngIf="f.m2construidos.dirty && f.m2construidos.errors?.required" class="text-danger">
                            Se debe introducir metros² construidos
                        </div>
                        <div *ngIf="f.m2construidos.dirty && f.m2construidos.errors?.minlength" class="text-danger">
                            Los metros² construidos introducido son incorrectos
                        </div>
                    </div>
                </div>
            </div>
            <label for="habitaciones" class="col-sm-2 col-form-label">Habitaciones</label>
            <div class="col-sm-10">
                <div class="row mb-3">
                    <div class="col-sm-10">
                        <input type="number" class="form-control" id="habitaciones" formControlName="habitaciones"
                            [ngClass]="{'is-valid' : f.habitaciones.dirty && !(f.habitaciones.errors?.required || f.habitaciones.errors?.minlength) }">
                        <div *ngIf="f.habitaciones.dirty && f.habitaciones.errors?.required" class="text-danger">
                            Se debe introducir habitaciones
                        </div>
                        <div *ngIf="f.habitaciones.dirty && f.habitaciones.errors?.minlength" class="text-danger">
                            Las habitaciones introducidas son incorrectas
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mb-3">
                <label for="conservacion" class="col-sm-2 col-form-label">Conservación</label>
                <div class="col-sm-10">
                    <div class="row mb-3">
                        <div class="col-sm-10">
                            <select class="selectpicker form-control" id="conservacion" formControlName="conservacion">
                                <option value="Reformado recientemente">Reformado recientemente</option>
                                <option value="Habitable">Habitable</option>
                                <option value="Necesita reforma">Necesita reforma</option>
                                <option value="Obra nueva">Obra nueva</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <label for="antiguedad" class="col-sm-2 col-form-label">Antigüedad (años)</label>
            <div class="col-sm-10">
                <div class="row mb-3">
                    <div class="col-sm-10">
                        <input type="number" class="form-control" id="antiguedad" formControlName="antiguedad">

                    </div>
                </div>
            </div>
            <label for="nplanta" class="col-sm-2 col-form-label">Nº de planta</label>
            <div class="col-sm-10">
                <div class="row mb-3">
                    <div class="col-sm-10">
                        <input type="number" class="form-control" id="nplanta" formControlName="nplanta">

                    </div>
                </div>
            </div>
            <label for="" class="col-sm-2 col-form-label"></label>

            <div class="col-sm-10">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="exterior" formControlName="exterior">

                    <label class="form-check-label" for="exterior">
                        Exterior
                    </label>
                </div>
            </div>

            <div class="row mb-3">
                <label for="descripcion" class="col-sm-2 col-form-label">Descripción</label>
                <div class="col-sm-10">
                    <div class="row mb-3">
                        <div class="col-sm-10">
                            <textarea class="form-control" id="descripcion" formControlName="descripcion" rows="3">

                                </textarea>
                        </div>
                    </div>
                </div>
            </div>
            <label for="anunciante" class="col-sm-2 col-form-label">Anunciante</label>

            <div class="col-sm-10">
                <div class="row mb-3">


                    <div class="col-sm-5">
                        <div class="input-group">
                            <span class="input-group-text">{{usuario.nombre+" "+usuario.apellido1}}</span>
                            <input type="number" class="form-control" id="idanunciante" formControlName="idanunciante"
                                (ngModelChange)="onChangeAnunciante($event)"
                                value="{{usuario.id}}" readonly>

                        </div>
                    </div>

                </div>
            </div>
            <label for="tusuario" class="col-sm-2 col-form-label">Zona</label>

            <div class="col-sm-10">
                <div class="row mb-3">
                    <label for="idzona" class="col-sm-2 col-form-label"> Nombre Zona</label>

                    <div class="col-sm-5">
                        <div class="input-group">
                            <span class="input-group-text">{{zonaToShow?.nombre}}</span>
                            <input type="number" class="form-control" id="idzona" formControlName="idzona"
                                (ngModelChange)="onChangeZona($event)">

                        </div>
                    </div>

                </div>
            </div>

            <label for="idtipovivienda" class="col-sm-2 col-form-label">Tipo de vivienda</label>

            <div class="col-sm-10">
                <div class="row mb-3">
                    <label for="idtipovivienda" class="col-sm-2 col-form-label"> Tipo</label>

                    <div class="col-sm-5">
                        <div class="input-group">
                            <span class="input-group-text">{{tipoToShow?.nombre}}</span>
                            <input type="number" class="form-control" id="idtipovivienda"
                                formControlName="idtipovivienda" (ngModelChange)="onChangeTipo($event)">

                        </div>
                    </div>

                </div>
            </div>

    </div>









    <div class="row mb-3 justify-content-center">
        <div class="d-grid gap-2 d-md-block mt-3 d-md-flex justify-content-md-center">
            <button type="submit" class="btn btn-warning" > Crear
                el {{strTitleSingular}}</button>
        </div>
    </div>

    </form>

    <div class="control-group text-center mt-5">
        <div class="d-grid gap-2 d-md-block mt-3 d-md-flex justify-content-md-center">
            <a class="btn btn-primary mx-2" [routerLink]="['/home']"><i class="fas fa-home"></i> Página
                principal</a>
            <a class="btn btn-primary mx-2" [routerLink]="['/usuario/plist']"><i class="fas fa-file-alt"></i>
                Listado de
                usuarios</a>
            <a class="btn btn-primary mx-2" (click)="goBack()"><i class="fas fa-arrow-circle-left"></i> Volver </a>
        </div>
    </div>

</div>
</div>



<app-footer></app-footer>
<app-modal [show]="eventsSubjectShowModal.asObservable()" [size]="'xl'" [hide]="eventsSubjectHideModal.asObservable()"
    (close)="onCloseModal()">

</app-modal>

<app-popup [show]="eventsSubjectShowPopup.asObservable()" [body]="strResult" (close)="onClosePopup()"></app-popup>

<script>
   function initMap() {
  const map = new google.maps.Map(document.getElementById("map"), {
    center: { lat: 40.749933, lng: -73.98633 },
    zoom: 13,
    mapTypeControl: false,
  });
  const card = document.getElementById("pac-card");
  const input = document.getElementById("pac-input");
  const biasInputElement = document.getElementById("use-location-bias");
  const strictBoundsInputElement = document.getElementById("use-strict-bounds");
  const options = {
    fields: ["formatted_address", "geometry", "name"],
    strictBounds: false,
    types: ["establishment"],
  };

  map.controls[google.maps.ControlPosition.TOP_LEFT].push(card);

  const autocomplete = new google.maps.places.Autocomplete(input, options);

  // Bind the map's bounds (viewport) property to the autocomplete object,
  // so that the autocomplete requests use the current map bounds for the
  // bounds option in the request.
  autocomplete.bindTo("bounds", map);

  const infowindow = new google.maps.InfoWindow();
  const infowindowContent = document.getElementById("infowindow-content");

  infowindow.setContent(infowindowContent);

  const marker = new google.maps.Marker({
    map,
    anchorPoint: new google.maps.Point(0, -29),
  });

  autocomplete.addListener("place_changed", () => {
    infowindow.close();
    marker.setVisible(false);

    const place = autocomplete.getPlace();

    if (!place.geometry || !place.geometry.location) {
      // User entered the name of a Place that was not suggested and
      // pressed the Enter key, or the Place Details request failed.
      window.alert("No details available for input: '" + place.name + "'");
      return;
    }

    // If the place has a geometry, then present it on a map.
    if (place.geometry.viewport) {
      map.fitBounds(place.geometry.viewport);
    } else {
      map.setCenter(place.geometry.location);
      map.setZoom(17);
    }

    marker.setPosition(place.geometry.location);
    marker.setVisible(true);
    infowindowContent.children["place-name"].textContent = place.name;
    infowindowContent.children["place-address"].textContent =
      place.formatted_address;
    infowindow.open(map, marker);
  });

  // Sets a listener on a radio button to change the filter type on Places
  // Autocomplete.
  function setupClickListener(id, types) {
    const radioButton = document.getElementById(id);

    radioButton.addEventListener("click", () => {
      autocomplete.setTypes(types);
      input.value = "";
    });
  }

  setupClickListener("changetype-all", []);
  setupClickListener("changetype-address", ["address"]);
  setupClickListener("changetype-establishment", ["establishment"]);
  setupClickListener("changetype-geocode", ["geocode"]);
  setupClickListener("changetype-cities", ["(cities)"]);
  setupClickListener("changetype-regions", ["(regions)"]);
  biasInputElement.addEventListener("change", () => {
    if (biasInputElement.checked) {
      autocomplete.bindTo("bounds", map);
    } else {
      // User wants to turn off location bias, so three things need to happen:
      // 1. Unbind from map
      // 2. Reset the bounds to whole world
      // 3. Uncheck the strict bounds checkbox UI (which also disables strict bounds)
      autocomplete.unbind("bounds");
      autocomplete.setBounds({ east: 180, west: -180, north: 90, south: -90 });
      strictBoundsInputElement.checked = biasInputElement.checked;
    }

    input.value = "";
  });
  strictBoundsInputElement.addEventListener("change", () => {
    autocomplete.setOptions({
      strictBounds: strictBoundsInputElement.checked,
    });
    if (strictBoundsInputElement.checked) {
      biasInputElement.checked = strictBoundsInputElement.checked;
      autocomplete.bindTo("bounds", map);
    }

    input.value = "";
  });
}
    </script>